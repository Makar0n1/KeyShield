# KeyShield Escrow Bot

ะะตะทะพะฟะฐัะฝัะน P2P escrow-ัะตัะฒะธั ะฝะฐ ะฑะฐะทะต TRON ะฑะปะพะบัะตะนะฝะฐ ั multisig-ะบะพัะตะปัะบะฐะผะธ ะดะปั USDT TRC20.

**ะกะฐะนั:** [keyshield.me](https://keyshield.me)
**Telegram ะฑะพั:** [@keyshield_bot](https://t.me/keyshield_bot)

---

## ะกะพะดะตัะถะฐะฝะธะต

1. [ะะฑะทะพั ัะธััะตะผั](#ะพะฑะทะพั-ัะธััะตะผั)
2. [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
3. [ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ](#ัััะฐะฝะพะฒะบะฐ-ะธ-ะฝะฐัััะพะนะบะฐ)
4. [ะะพะฝัะธะณััะฐัะธั](#ะบะพะฝัะธะณััะฐัะธั)
5. [Telegram ะฑะพั](#telegram-ะฑะพั)
6. [ะัะพัะตัั ัะดะตะปะบะธ](#ะฟัะพัะตัั-ัะดะตะปะบะธ)
7. [Multisig ะบะพัะตะปัะบะธ](#multisig-ะบะพัะตะปัะบะธ)
8. [ะกะธััะตะผะฐ ะบะพะผะธััะธะน](#ัะธััะตะผะฐ-ะบะพะผะธััะธะน)
9. [ะะฐััะฝัััะบะฐั ะฟัะพะณัะฐะผะผะฐ](#ะฟะฐััะฝัััะบะฐั-ะฟัะพะณัะฐะผะผะฐ)
10. [ะะดะผะธะฝ-ะฟะฐะฝะตะปั](#ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั)
11. [ะะตะฑ-ัะฐะนั](#ะฒะตะฑ-ัะฐะนั)
12. [API ัะฝะดะฟะพะธะฝัั](#api-ัะฝะดะฟะพะธะฝัั)
13. [ะะฐะทะฐ ะดะฐะฝะฝัั](#ะฑะฐะทะฐ-ะดะฐะฝะฝัั)
14. [ะะตะทะพะฟะฐัะฝะพััั](#ะฑะตะทะพะฟะฐัะฝะพััั)
15. [ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต](#ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต)
16. [ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต](#ะผะพะฝะธัะพัะธะฝะณ-ะธ-ะปะพะณะธัะพะฒะฐะฝะธะต)

---

## ะะฑะทะพั ัะธััะตะผั

KeyShield โ ััะพ escrow-ัะตัะฒะธั ะดะปั ะฑะตะทะพะฟะฐัะฝัั P2P ัะดะตะปะพะบ ั ะบัะธะฟัะพะฒะฐะปััะพะน. ะะพะบัะฟะฐัะตะปั ะทะฐะผะพัะฐะถะธะฒะฐะตั ััะตะดััะฒะฐ ะฒ multisig-ะบะพัะตะปัะบะต, ะฟัะพะดะฐะฒะตั ะฒัะฟะพะปะฝัะตั ัะฐะฑะพัั, ะฟะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั โ ััะตะดััะฒะฐ ะฟะตัะตะฒะพะดัััั ะฟัะพะดะฐะฒัั.

### ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

- **Multisig ะบะพัะตะปัะบะธ** โ 2-of-3 ะฟะพะดะฟะธัะธ (ะฟะพะบัะฟะฐัะตะปั + ะฟัะพะดะฐะฒะตั ะธะปะธ ะฐัะฑะธัั)
- **ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ะดะตะฟะพะทะธัะพะฒ** โ ะฟะฐัะฐะปะปะตะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ะดะพ 8 ัะดะตะปะพะบ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
- **ะกะธััะตะผะฐ ัะฟะพัะพะฒ** โ ะฐัะฑะธััะฐะถ ั ะดะพะบะฐะทะฐัะตะปัััะฒะฐะผะธ (ัะพัะพ/ะฒะธะดะตะพ/ะดะพะบัะผะตะฝัั)
- **ะะฐััะฝัััะบะฐั ะฟัะพะณัะฐะผะผะฐ** โ ัะตัะตัะฐะปัะฝัะต ัััะปะบะธ ั ะฐะฝะฐะปะธัะธะบะพะน ะธ ะฟะฐััะฝัััะบะธะผะธ ะฒัะฟะปะฐัะฐะผะธ
- **Telegram ะฑะพั** โ ะฟะพะปะฝัะน ัะธะบะป ัะดะตะปะบะธ ะฒ ัะฐัะต
- **Deadline Monitor** โ ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะตัะฐะฝะดั ะฟัะธ ะธััะตัะตะฝะธะธ ะดะตะดะปะฐะนะฝะฐ + 12ั grace period
- **ะะดะฐะฟัะธะฒะฝัะน ะฒะตะฑ-ัะฐะนั** โ ะปะตะฝะดะธะฝะณ ั ะผะพะฑะธะปัะฝัะผ ะผะตะฝั ะธ SEO-ะพะฟัะธะผะธะทะฐัะธะตะน

### ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะฐะบัะธะฒั

| ะะบัะธะฒ | ะกะตัั | ะะพะฝััะฐะบั |
|-------|------|----------|
| USDT | TRC20 | TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t |
| TRX | TRON | Native |

---

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ
โ  Telegram Bot   โโโโโโถโ   Node.js API   โโโโโโถโ    MongoDB      โ
โ   (Telegraf)    โ     โ   (Express)     โ     โ                 โ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโฌโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
                        โโโโโโโโโโโโโโโโโโโ
                        โ  TRON Blockchainโ
                        โ   (TronWeb)     โ
                        โโโโโโโโโโโโโโโโโโโ
```

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
src/
โโโ bot/                    # Telegram ะฑะพั
โ   โโโ handlers/           # ะะฑัะฐะฑะพััะธะบะธ ะบะพะผะฐะฝะด
โ   โ   โโโ start.js        # /start ะธ ะณะปะฐะฒะฝะพะต ะผะตะฝั
โ   โ   โโโ createDeal.js   # ะกะพะทะดะฐะฝะธะต ัะดะตะปะบะธ
โ   โ   โโโ myDeals.js      # ะะพะธ ัะดะตะปะบะธ
โ   โ   โโโ provideWallet.js # ะะฒะพะด ะบะพัะตะปัะบะฐ ะบะพะฝััะฐะณะตะฝัะพะผ
โ   โ   โโโ dispute.js      # ะกะฟะพัั
โ   โ   โโโ help.js         # ะะพะผะพัั
โ   โโโ keyboards/          # Inline-ะบะปะฐะฒะธะฐัััั
โ   โโโ utils/              # ะฃัะธะปะธัั (messageManager)
โโโ models/                 # MongoDB ััะตะผั
โ   โโโ Deal.js             # ะกะดะตะปะบะฐ
โ   โโโ User.js             # ะะพะปัะทะพะฒะฐัะตะปั
โ   โโโ Transaction.js      # ะขัะฐะฝะทะฐะบัะธั
โ   โโโ MultisigWallet.js   # Multisig ะบะพัะตะปัะบ
โ   โโโ Dispute.js          # ะกะฟะพั
โ   โโโ Platform.js         # ะะฐััะฝัััะบะฐั ะฟะปะฐััะพัะผะฐ
โ   โโโ AuditLog.js         # ะัะดะธั-ะปะพะณ
โโโ services/               # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ blockchain.js       # ะะฐะฑะพัะฐ ั TRON
โ   โโโ dealService.js      # ะกะตัะฒะธั ัะดะตะปะพะบ
โ   โโโ depositMonitor.js   # ะะพะฝะธัะพัะธะฝะณ ะดะตะฟะพะทะธัะพะฒ
โ   โโโ deadlineMonitor.js  # ะะพะฝะธัะพัะธะฝะณ ะดะตะดะปะฐะนะฝะพะฒ
โ   โโโ disputeService.js   # ะกะฟะพัั
โ   โโโ banService.js       # ะะฐะฝ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โ   โโโ notificationService.js # ะฃะฒะตะดะพะผะปะตะฝะธั
โโโ web/                    # ะะตะฑ-ัะตัะฒะตั
โ   โโโ server.js           # Express ัะตัะฒะตั
โ   โโโ routes/             # API ะผะฐัััััั
โ       โโโ partner.js      # ะะฐััะฝัััะบะธะน API
โโโ config/                 # ะะพะฝัะธะณััะฐัะธั
โ   โโโ constants.js        # ะะพะฝััะฐะฝัั
โ   โโโ database.js         # ะะพะดะบะปััะตะฝะธะต MongoDB
โ   โโโ tron.js             # ะะฐัััะพะนะบะธ TRON
โโโ api/                    # API ัะพััั
โ   โโโ routes/             # ะะฐัััััั
โ   โโโ middleware/         # Middleware (auth, errorHandler)
โโโ index.js                # ะขะพัะบะฐ ะฒัะพะดะฐ

public/                     # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั ัะฐะนัะฐ
โโโ index.html              # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โโโ terms.html              # ะฃัะปะพะฒะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
โโโ privacy.html            # ะะพะปะธัะธะบะฐ ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝะพััะธ
โโโ offer.html              # ะัะฑะปะธัะฝะฐั ะพัะตััะฐ
โโโ not-found.html          # ะกััะฐะฝะธัะฐ 404
โโโ admin.html              # ะะดะผะธะฝ-ะฟะฐะฝะตะปั
โโโ css/style.css           # ะกัะธะปะธ
โโโ js/main.js              # ะกะบัะธะฟัั
โโโ images/                 # ะะทะพะฑัะฐะถะตะฝะธั
```

---

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ

### ะขัะตะฑะพะฒะฐะฝะธั

- Node.js 18+
- MongoDB 6+
- TRON ะบะพัะตะปัะบ ั TRX ะดะปั ะบะพะผะธััะธะน

### ะฃััะฐะฝะพะฒะบะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone <repository-url>
cd keyshield

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
npm install

# ะกะบะพะฟะธัะพะฒะฐัั ะบะพะฝัะธะณััะฐัะธั
cp .env.example .env

# ะะฐัััะพะธัั .env (ัะผ. ัะฐะทะดะตะป ะะพะฝัะธะณััะฐัะธั)

# ะะฐะฟัััะธัั
npm start
```

### ะะฐะฟััะบ ะฒ production

```bash
# ะก PM2
pm2 start src/index.js --name keyshield

# ะะปะธ ั Docker
docker-compose up -d
```

---

## ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)

```env
# MongoDB
MONGODB_URI=mongodb://localhost:27017/keyshield

# Telegram Bot
BOT_TOKEN=your_bot_token_here
BOT_USERNAME=your_bot_username

# TRON Configuration
TRON_FULL_NODE=https://api.trongrid.io
TRON_SOLIDITY_NODE=https://api.trongrid.io
TRON_EVENT_SERVER=https://api.trongrid.io
TRONGRID_API_KEY=your_trongrid_api_key

# Arbiter Wallet (ะณะปะฐะฒะฝัะน ะบะพัะตะปัะบ ะฐัะฑะธััะฐ)
ARBITER_PRIVATE_KEY=your_private_key_hex
ARBITER_ADDRESS=your_tron_address

# Service Wallet (ะดะปั ัะฑะพัะฐ ะบะพะผะธััะธะน)
SERVICE_WALLET_ADDRESS=your_service_wallet

# API & Web
API_PORT=3000
WEB_PORT=3001

# Admin Panel
JWT_SECRET=your_jwt_secret
JWT_EXPIRES_IN=7d
ADMIN_USERNAME=admin
ADMIN_PASSWORD=secure_password

# Environment
NODE_ENV=production

# USDT Contract
USDT_CONTRACT_ADDRESS=TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t

# Deal Settings
MIN_DEAL_AMOUNT=50

# Commission
COMMISSION_RATE=0.05
MIN_COMMISSION_USDT=15
COMMISSION_THRESHOLD=300

# Monitoring
DEPOSIT_CHECK_INTERVAL=30000
MULTISIG_ACTIVATION_TRX=15
```

---

## Telegram ะฑะพั

### ะะพะผะฐะฝะดั

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `/start` | ะะตะณะธัััะฐัะธั ะธ ะณะปะฐะฒะฝะพะต ะผะตะฝั |
| `/menu` | ะะปะฐะฒะฝะพะต ะผะตะฝั |
| `/help` | ะกะฟัะฐะฒะบะฐ |
| `DEAL_XXXXXX` | ะัะพัะผะพัั ัะดะตะปะบะธ ะฟะพ ID |

### ะะปะฐะฒะฝะพะต ะผะตะฝั

```
๐ ะะปะฐะฒะฝะพะต ะผะตะฝั

โโโ ๐ ะกะพะทะดะฐัั ัะดะตะปะบั (ะบะฐะบ ะฟะพะบัะฟะฐัะตะปั)
โโโ ๐ผ ะกะพะทะดะฐัั ัะดะตะปะบั (ะบะฐะบ ะฟัะพะดะฐะฒะตั)
โโโ ๐ ะะพะธ ัะดะตะปะบะธ
โโโ ๐ฐ ะะพะน ะบะพัะตะปัะบ
โโโ โน๏ธ ะะพะผะพัั
```

### ะัะพัะตัั ัะพะทะดะฐะฝะธั ัะดะตะปะบะธ

1. **ะัะฑะพั ัะพะปะธ** โ ะฟะพะบัะฟะฐัะตะปั ะธะปะธ ะฟัะพะดะฐะฒะตั
2. **ะะฒะพะด ID ะบะพะฝััะฐะณะตะฝัะฐ** โ Telegram ID ะธะปะธ @username
3. **ะะฐะทะฒะฐะฝะธะต ัะพะฒะฐัะฐ/ััะปัะณะธ**
4. **ะะฟะธัะฐะฝะธะต** (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะผะพะถะฝะพ ะฟัะพะฟัััะธัั)
5. **ะกัะผะผะฐ ะฒ USDT**
6. **ะัะพ ะฟะปะฐัะธั ะบะพะผะธััะธั** โ ะฟะพะบัะฟะฐัะตะปั / ะฟัะพะดะฐะฒะตั / ะฟะพะฟะพะปะฐะผ
7. **ะะตะดะปะฐะนะฝ** โ 24ั / 48ั / 72ั / 7 ะดะฝะตะน
8. **ะะดัะตั ะบะพัะตะปัะบะฐ** โ ะดะปั ะฟะพะปััะตะฝะธั ััะตะดััะฒ
9. **ะะพะดัะฒะตัะถะดะตะฝะธะต** โ ะณะตะฝะตัะฐัะธั multisig-ะบะพัะตะปัะบะฐ

---

## ะัะพัะตัั ัะดะตะปะบะธ

### ะกัะฐัััั ัะดะตะปะบะธ

```
waiting_for_seller_wallet  โโโถ  ะะถะธะดะฐะฝะธะต ะบะพัะตะปัะบะฐ ะฟัะพะดะฐะฒัะฐ
waiting_for_buyer_wallet   โโโถ  ะะถะธะดะฐะฝะธะต ะบะพัะตะปัะบะฐ ะฟะพะบัะฟะฐัะตะปั
waiting_for_deposit        โโโถ  ะะถะธะดะฐะฝะธะต ะดะตะฟะพะทะธัะฐ
locked                     โโโถ  ะกัะตะดััะฒะฐ ะทะฐะผะพัะพะถะตะฝั
in_progress                โโโถ  ะะฐะฑะพัะฐ ะฒะตะดัััั
dispute                    โโโถ  ะัะบััั ัะฟะพั
completed                  โโโถ  ะฃัะฟะตัะฝะพ ะทะฐะฒะตััะตะฝะฐ
cancelled                  โโโถ  ะัะผะตะฝะตะฝะฐ
resolved                   โโโถ  ะะตัะตะฝะฐ ะฐัะฑะธััะพะผ
expired                    โโโถ  ะะฒัะพ-ัะตัะฐะฝะด (ะดะตะดะปะฐะนะฝ + 12ั)
```

### ะะธะทะฝะตะฝะฝัะน ัะธะบะป ัะดะตะปะบะธ

```
โโโโโโโโโโโโโโโโโโโ
โ  ะกะพะทะดะฐะฝะธะต       โ
โ  ัะดะตะปะบะธ         โ
โโโโโโโโโโฌโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ะะถะธะดะฐะฝะธะต       โโโโโ ะะพะฝััะฐะณะตะฝั ัะบะฐะทัะฒะฐะตั ะบะพัะตะปัะบ
โ  ะบะพัะตะปัะบะพะฒ      โ
โโโโโโโโโโฌโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ะะถะธะดะฐะฝะธะต       โโโโโ ะะพะบัะฟะฐัะตะปั ะฟะตัะตะฒะพะดะธั USDT
โ  ะดะตะฟะพะทะธัะฐ       โ
โโโโโโโโโโฌโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ะะฐะผะพัะพะถะตะฝะพ     โโโโโ ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต
โ  (locked)       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
    โโโโโโดโโโโโ
    โผ         โผ
โโโโโโโโโ โโโโโโโโโ
โะะพะดัะฒ. โ โ ะกะฟะพั  โ
โัะฐะฑะพัั โ โ       โ
โโโโโฌโโโโ โโโโโฌโโโโ
    โ         โ
    โผ         โผ
โโโโโโโโโ โโโโโโโโโ
โะัะฟะปะฐัะฐโ โะัะฑะธัั โ
โะฟัะพะด-ััโ โัะตัะฐะตั โ
โโโโโโโโโ โโโโโโโโโ
```

### ะะตะนััะฒะธั ััะพัะพะฝ

**ะะพะบัะฟะฐัะตะปั:**
- ะะพะดัะฒะตัะดะธัั ัะฐะฑะพัั โ ะฒัะฟะปะฐัะฐ ะฟัะพะดะฐะฒัั
- ะัะบัััั ัะฟะพั โ ะฐัะฑะธััะฐะถ
- ะัะผะตะฝะธัั (ะดะพ ะดะตะฟะพะทะธัะฐ)

**ะัะพะดะฐะฒะตั:**
- ะัะผะตัะธัั "ะะฐะฑะพัะฐ ัะดะฐะฝะฐ"
- ะัะบัััั ัะฟะพั
- ะัะผะตะฝะธัั (ะดะพ ะดะตะฟะพะทะธัะฐ)

---

## Multisig ะบะพัะตะปัะบะธ

### ะัะธะฝัะธะฟ ัะฐะฑะพัั

ะะปั ะบะฐะถะดะพะน ัะดะตะปะบะธ ัะพะทะดะฐัััั ัะฝะธะบะฐะปัะฝัะน multisig-ะบะพัะตะปัะบ ั 3 ะบะปััะฐะผะธ:
- **ะัะตะผะตะฝะฝัะน ะบะปัั ะฟะพะบัะฟะฐัะตะปั** (ะณะตะฝะตัะธััะตััั ัะธััะตะผะพะน)
- **ะัะตะผะตะฝะฝัะน ะบะปัั ะฟัะพะดะฐะฒัะฐ** (ะณะตะฝะตัะธััะตััั ัะธััะตะผะพะน)
- **ะะปัั ะฐัะฑะธััะฐ** (ะฟะพััะพัะฝะฝัะน, ะธะท .env)

ะะพัะพะณ ะฟะพะดะฟะธัะตะน: **2 ะธะท 3**

### ะกัะตะฝะฐัะธะธ ะฒัะฟะปะฐั

| ะกัะตะฝะฐัะธะน | ะะพะดะฟะธัะธ | ะะตะทัะปััะฐั |
|----------|---------|-----------|
| ะฃัะฟะตั | ะะพะบัะฟะฐัะตะปั + ะัะพะดะฐะฒะตั | ะัะพะดะฐะฒัั |
| ะกะฟะพั (ะฟัะพะดะฐะฒะตั ะฟัะฐะฒ) | ะัะฑะธัั + ะัะพะดะฐะฒะตั | ะัะพะดะฐะฒัั |
| ะกะฟะพั (ะฟะพะบัะฟะฐัะตะปั ะฟัะฐะฒ) | ะัะฑะธัั + ะะพะบัะฟะฐัะตะปั | ะะพะบัะฟะฐัะตะปั |
| ะัะผะตะฝะฐ | ะะพะบัะฟะฐัะตะปั + ะัะพะดะฐะฒะตั | ะะพะบัะฟะฐัะตะปั |

### ะะบัะธะฒะฐัะธั ะบะพัะตะปัะบะฐ

ะะพัะปะต ะพะฑะฝะฐััะถะตะฝะธั ะดะตะฟะพะทะธัะฐ, ะบะพัะตะปัะบ ะฐะบัะธะฒะธััะตััั:
- ะะตัะตะฒะพะด 15 TRX ะดะปั ะพะฟะปะฐัั gas
- ะะพัะปะตะดะพะฒะฐัะตะปัะฝะฐั ะพัะตัะตะดั (ะธะทะฑะตะณะฐะตั ะบะพะฝัะปะธะบัะพะฒ)
- ะะฐะฟะธัั ะทะฐััะฐั ะฒ `operationalCosts`

### Deadline Monitor

ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะพะฝะธัะพัะธะฝะณ ะดะตะดะปะฐะนะฝะพะฒ ัะดะตะปะพะบ:

1. **ะะตะดะปะฐะนะฝ ะธัััะบ** โ ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑะตะธะผ ััะพัะพะฝะฐะผ
2. **+12 ัะฐัะพะฒ ะฑะตะท ะดะตะนััะฒะธะน** โ ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตัะฐะฝะด ะฟะพะบัะฟะฐัะตะปั
3. ะะฝัะตัะฒะฐะป ะฟัะพะฒะตัะบะธ: ะบะฐะถะดัะต 5 ะผะธะฝัั
4. Batch processing: 5 ัะดะตะปะพะบ ะทะฐ ัะฐะท

```javascript
// Grace period: 12 ัะฐัะพะฒ ะฟะพัะปะต ะดะตะดะปะฐะนะฝะฐ
GRACE_PERIOD_MS = 12 * 60 * 60 * 1000

// ะกัะฐััั ะฟะพัะปะต ะฐะฒัะพ-ัะตัะฐะฝะดะฐ
status: 'expired'
```

---

## ะกะธััะตะผะฐ ะบะพะผะธััะธะน

### ะะฐัััั ะบะพะผะธััะธะธ

```javascript
// ะะฐะทะพะฒะฐั ััะฐะฒะบะฐ: 5%
// ะะธะฝะธะผัะผ: 15 USDT
// ะะพัะพะณ: 300 USDT

if (amount <= 300) {
  commission = 15; // ะคะธะบัะธัะพะฒะฐะฝะฝะฐั
} else {
  commission = amount * 0.05; // 5%
}
```

### ะัะธะผะตัั

| ะกัะผะผะฐ ัะดะตะปะบะธ | ะะพะผะธััะธั |
|--------------|----------|
| 50 USDT | 15 USDT |
| 100 USDT | 15 USDT |
| 300 USDT | 15 USDT |
| 500 USDT | 25 USDT |
| 1000 USDT | 50 USDT |

### ะัะพ ะฟะปะฐัะธั ะบะพะผะธััะธั

- **buyer** โ ะฟะพะบัะฟะฐัะตะปั (ะดะตะฟะพะทะธั = ััะผะผะฐ + ะบะพะผะธััะธั)
- **seller** โ ะฟัะพะดะฐะฒะตั (ะฟะพะปััะฐะตั ััะผะผะฐ - ะบะพะผะธััะธั)
- **split** โ ะฟะพะฟะพะปะฐะผ (ะบะฐะถะดัะน ะฟะปะฐัะธั 50%)

---

## ะะฐััะฝัััะบะฐั ะฟัะพะณัะฐะผะผะฐ

### ะกะพะทะดะฐะฝะธะต ะฟะปะฐััะพัะผั

```javascript
// POST /api/partner/register
{
  "name": "CryptoForum",
  "email": "admin@cryptoforum.com",
  "website": "https://cryptoforum.com"
}

// Response
{
  "platform": {
    "code": "CRYPTOF",
    "apiKey": "pk_live_xxxxx",
    "referralLink": "https://t.me/bot?start=ref_CRYPTOF"
  }
}
```

### ะะตัะตัะฐะปัะฝะฐั ัััะปะบะฐ

```
https://t.me/keyshield_bot?start=ref_PLATFORMCODE
```

ะัะธ ะฟะตัะตัะพะดะต ะฟะพ ัััะปะบะต:
1. ะะพะปัะทะพะฒะฐัะตะปั ะฟัะธะฒัะทัะฒะฐะตััั ะบ ะฟะปะฐััะพัะผะต
2. ะัะต ะตะณะพ ัะดะตะปะบะธ ััะธััะฒะฐัััั ะฒ ััะฐัะธััะธะบะต
3. ะะปะฐััะพัะผะฐ ะฟะพะปััะฐะตั % ะพั ะบะพะผะธััะธะน (ะฝะฐัััะฐะธะฒะฐะตััั)

### ะกัะฐัะธััะธะบะฐ ะดะปั ะฟะฐััะฝััะพะฒ

```javascript
// GET /api/partner/stats
{
  "stats": {
    "totalUsers": 150,
    "totalDeals": 45,
    "completedDeals": 38,
    "totalVolume": 15420.50,
    "totalCommission": 771.02,
    "netProfit": 698.45,
    "platformEarnings": 69.85  // commissionPercent ะพั netProfit
  }
}
```

### ะะฐัััั ะฟะฐััะฝัััะบะพะณะพ ะฒะพะทะฝะฐะณัะฐะถะดะตะฝะธั

```javascript
// ะะปั ะบะฐะถะดะพะน ะฟะปะฐััะพัะผั:
platformNetProfit = platformCommission - (platformDeals ร 16.1 TRX ร 0.28)
platformPayout = platformNetProfit ร (commissionPercent / 100)

// ะะพ ัะผะพะปัะฐะฝะธั commissionPercent = 10%
```

### ะะฐััะฝัััะบะธะน ะบะฐะฑะธะฝะตั

- ะะธัะฝัะน ะบะฐะฑะธะฝะตั ะฟะฐััะฝััะฐ: `/partner`
- ะะฒัะพัะธะทะฐัะธั ะฟะพ ะปะพะณะธะฝั/ะฟะฐัะพะปั
- ะกัะฐัะธััะธะบะฐ: ะฟะพะปัะทะพะฒะฐัะตะปะธ, ัะดะตะปะบะธ, ะพะฑััะผ, ะดะพัะพะด
- ะะตัะตัะฐะปัะฝะฐั ัััะปะบะฐ ะดะปั ะฟัะธะฒะปะตัะตะฝะธั

---

## ะะดะผะธะฝ-ะฟะฐะฝะตะปั

### ะะฒัะพัะธะทะฐัะธั

```javascript
// POST /api/admin/login
{
  "username": "admin",
  "password": "your_password"
}

// Response
{
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### ะญะฝะดะฟะพะธะฝัั

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| POST | /api/admin/login | ะะฒัะพัะธะทะฐัะธั |
| GET | /api/admin/stats | ะะฑัะฐั ััะฐัะธััะธะบะฐ |
| GET | /api/admin/deals | ะกะฟะธัะพะบ ัะดะตะปะพะบ |
| GET | /api/admin/deals/:id | ะะตัะฐะปะธ ัะดะตะปะบะธ |
| GET | /api/admin/users | ะกะฟะธัะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน |
| POST | /api/admin/users/:id/ban | ะะฐะฑะฐะฝะธัั |
| GET | /api/admin/disputes | ะะบัะธะฒะฝัะต ัะฟะพัั |
| POST | /api/admin/disputes/:id/resolve | ะะตัะธัั ัะฟะพั |
| GET | /api/admin/platforms | ะะฐััะฝััั |
| GET | /api/admin/audit | ะัะดะธั-ะปะพะณ |

### ะะตะฑ-ะธะฝัะตััะตะนั

ะะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั `/admin`

#### ะคะธะฝะฐะฝัะพะฒะฐั ััะฐัะธััะธะบะฐ

ะะดะผะธะฝ-ะฟะฐะฝะตะปั ะพัะพะฑัะฐะถะฐะตั ะดะตัะฐะปัะฝัั ัะธะฝะฐะฝัะพะฒัั ััะฐัะธััะธะบั:

| ะะพะบะฐะทะฐัะตะปั | ะะฟะธัะฐะฝะธะต |
|------------|----------|
| ะะฐะปะพะฒะฐั ะฒััััะบะฐ | ะกัะผะผะฐ ะฒัะตั ะบะพะผะธััะธะน ั ะทะฐะฒะตัััะฝะฝัั ัะดะตะปะพะบ |
| ะะฐััะพะดั TRX | 16.1 TRX ร ะบะพะปะธัะตััะฒะพ ัะดะตะปะพะบ |
| ะะฐััะพะดั USDT | TRX ัะฐััะพะดั ร ะบััั (0.28 USDT) |
| ะงะธััะฐั ะฟัะธะฑัะปั | ะััััะบะฐ โ ะะฐััะพะดั |
| ะ ะฒัะฟะปะฐัะต ะฟะฐััะฝััะฐะผ | ะกัะผะผะฐ ะฟะฐััะฝัััะบะธั ะฒัะฟะปะฐั |
| ะงะธััะตะนัะฐั ะฟัะธะฑัะปั | ะงะธััะฐั ะฟัะธะฑัะปั โ ะะฐััะฝัััะบะธะต ะฒัะฟะปะฐัั |

#### ะฃะฟัะฐะฒะปะตะฝะธะต ัะฟะพัะฐะผะธ

- ะัะพัะผะพัั ะดะตัะฐะปะตะน ัะฟะพัะฐ ั ะดะพะบะฐะทะฐัะตะปัััะฒะฐะผะธ
- ะะฐะปะตัะตั ะธะทะพะฑัะฐะถะตะฝะธะน ั ะฝะฐะฒะธะณะฐัะธะตะน
- ะะตัะตะฝะธะต ัะฟะพัะฐ ะฒ ะฟะพะปัะทั ะฟะพะบัะฟะฐัะตะปั ะธะปะธ ะฟัะพะดะฐะฒัะฐ
- ะะพะทะฒัะฐั ัะดะตะปะบะธ ะฒ ััะฐััั "in_progress"
- ะัะผะตะฝะฐ ัะฟะพัะฐ

---

## ะะตะฑ-ัะฐะนั

### ะกััะฐะฝะธัั

| URL | ะกััะฐะฝะธัะฐ |
|-----|----------|
| `/` | ะะปะฐะฒะฝะฐั (ะปะตะฝะดะธะฝะณ) |
| `/terms` | ะฃัะปะพะฒะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธั |
| `/privacy` | ะะพะปะธัะธะบะฐ ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝะพััะธ |
| `/offer` | ะัะฑะปะธัะฝะฐั ะพัะตััะฐ |
| `/admin` | ะะดะผะธะฝ-ะฟะฐะฝะตะปั |

### ะัะพะฑะตะฝะฝะพััะธ

- **ะะดะฐะฟัะธะฒะฝัะน ะดะธะทะฐะนะฝ** โ ะบะพััะตะบัะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต ะฝะฐ ะผะพะฑะธะปัะฝัั ััััะพะนััะฒะฐั
- **ะะพะฑะธะปัะฝะพะต ะผะตะฝั** โ ัะธะบัะธัะพะฒะฐะฝะฝะพะต ะผะตะฝั ั ะฐะฝะธะผะฐัะธะตะน, ะฐะฒัะพะทะฐะบัััะธะต ะฟัะธ ะบะปะธะบะต ะฝะฐ anchor-ัััะปะบะธ
- **SEO-ะพะฟัะธะผะธะทะฐัะธั** โ ะผะตัะฐ-ัะตะณะธ, Open Graph, canonical URLs
- **Clean URLs** โ ัะพััะธะฝะณ ัะตัะตะท Express ะฒะผะตััะพ .html ัะฐััะธัะตะฝะธะน

### ะขะตัะฝะพะปะพะณะธะธ

- **CSS Variables** โ ัะตะผะฝะฐั ัะตะผะฐ, ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝัะต ัะฒะตัะฐ
- **CSS Grid & Flexbox** โ ะฐะดะฐะฟัะธะฒะฝะฐั ัะตัะบะฐ
- **Vanilla JS** โ ะฑะตะท ะทะฐะฒะธัะธะผะพััะตะน
- **Inter font** โ Google Fonts

---

## API ัะฝะดะฟะพะธะฝัั

### ะัะฑะปะธัะฝัะต

```
GET  /api/health              # ะัะพะฒะตัะบะฐ ััะฐัััะฐ
GET  /api/stats/public        # ะัะฑะปะธัะฝะฐั ััะฐัะธััะธะบะฐ
```

### ะะฐััะฝัััะบะธะต (ััะตะฑััั API ะบะปัั)

```
POST /api/partner/register    # ะะตะณะธัััะฐัะธั ะฟะปะฐััะพัะผั
GET  /api/partner/stats       # ะกัะฐัะธััะธะบะฐ ะฟะปะฐััะพัะผั
GET  /api/partner/users       # ะะพะปัะทะพะฒะฐัะตะปะธ ะฟะปะฐััะพัะผั
GET  /api/partner/deals       # ะกะดะตะปะบะธ ะฟะปะฐััะพัะผั
```

### ะะดะผะธะฝัะบะธะต (ััะตะฑััั JWT)

```
POST /api/admin/login         # ะะฒัะพัะธะทะฐัะธั
GET  /api/admin/stats         # ะะพะปะฝะฐั ััะฐัะธััะธะบะฐ
GET  /api/admin/deals         # ะัะต ัะดะตะปะบะธ
POST /api/admin/disputes/:id/resolve  # ะะตัะตะฝะธะต ัะฟะพัะฐ
```

---

## ะะฐะทะฐ ะดะฐะฝะฝัั

### ะะพะปะปะตะบัะธะธ

| ะะพะปะปะตะบัะธั | ะะฟะธัะฐะฝะธะต |
|-----------|----------|
| users | ะะพะปัะทะพะฒะฐัะตะปะธ Telegram |
| deals | ะกะดะตะปะบะธ |
| transactions | ะขัะฐะฝะทะฐะบัะธะธ ะฑะปะพะบัะตะนะฝะฐ |
| multisigwallets | Multisig ะบะพัะตะปัะบะธ |
| disputes | ะกะฟะพัั |
| platforms | ะะฐััะฝัััะบะธะต ะฟะปะฐััะพัะผั |
| auditlogs | ะัะดะธั-ะปะพะณ ะดะตะนััะฒะธะน |

### ะะฝะดะตะบัั

```javascript
// Deal
{ status: 1, multisigAddress: 1 }  // depositMonitor
{ uniqueKey: 1, status: 1 }        // ะดัะฑะปะธะบะฐัั
{ platformId: 1, status: 1 }       // ะฟะฐััะฝััั
{ buyerId: 1 }
{ sellerId: 1 }
{ dealId: 1 }                      // unique

// User
{ telegramId: 1 }                  // unique
{ platformId: 1 }
{ blacklisted: 1 }

// Transaction
{ dealId: 1 }
{ txHash: 1 }

// Platform
{ code: 1 }                        // unique
{ apiKey: 1 }                      // unique
```

---

## ะะตะทะพะฟะฐัะฝะพััั

### ะฅัะฐะฝะตะฝะธะต ะบะปััะตะน

- ะัะธะฒะฐัะฝัะต ะบะปััะธ ััะฐะฝัััั ะฒ ะทะฐัะธััะพะฒะฐะฝะฝะพะผ ะฒะธะดะต
- ะะปัั ะฐัะฑะธััะฐ ัะพะปัะบะพ ะฒ .env (ะฝะธะบะพะณะดะฐ ะฒ ะะ)
- ะัะตะผะตะฝะฝัะต ะบะปััะธ ัะดะตะปะพะบ ัะดะฐะปััััั ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั

### ะะฐัะธัะฐ ะพั ะฐัะฐะบ

| ะฃะณัะพะทะฐ | ะะฐัะธัะฐ |
|--------|--------|
| Double-spend | ะะพะดัะฒะตัะถะดะตะฝะธะต ะฑะปะพะบะฐ + ะฟัะพะฒะตัะบะฐ txHash |
| Race condition | processedDeposits Set + double-check ะฒ ะะ |
| Memory leak | ะะฒัะพะพัะธััะบะฐ Map ะบะฐะถะดัะต 30 ะผะธะฝัั |
| API abuse | Rate limiting + JWT + API ะบะปััะธ |
| MITM | HTTPS only + TronGrid HTTPS |

### ะงะตะบะปะธัั ะฑะตะทะพะฟะฐัะฝะพััะธ

- [ ] ะกะผะตะฝะธัั ADMIN_PASSWORD
- [ ] ะกะณะตะฝะตัะธัะพะฒะฐัั ะฝะพะฒัะน JWT_SECRET
- [ ] ะัะฟะพะปัะทะพะฒะฐัั ะพัะดะตะปัะฝัะน ะบะพัะตะปัะบ ะฐัะฑะธััะฐ
- [ ] ะะฐัััะพะธัั HTTPS
- [ ] ะะณัะฐะฝะธัะธัั ะดะพัััะฟ ะบ MongoDB
- [ ] ะะตะณัะปััะฝัะต ะฑัะบะฐะฟั ะะ

---

## ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

### ะขะตะบััะธะต ะปะธะผะธัั

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต |
|---------|----------|
| ะะฐัะฐะปะปะตะปัะฝัั ะฟัะพะฒะตัะพะบ ะดะตะฟะพะทะธัะพะฒ | 8 |
| TronGrid API requests/sec | 10 |
| ะกะตััะธะน ะฒ ะฟะฐะผััะธ | 5000 |
| ะกะดะตะปะพะบ ะฒ ะผะตััั | 10,000+ |

### ะะฟัะธะผะธะทะฐัะธะธ (ัะตะฐะปะธะทะพะฒะฐะฝะพ)

1. **ะะฐัะฐะปะปะตะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ะดะตะฟะพะทะธัะพะฒ**
   - 8 ัะดะตะปะพะบ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
   - Promise.allSettled ะดะปั ัััะพะนัะธะฒะพััะธ
   - 1 ัะตะบ ะทะฐะดะตัะถะบะฐ ะผะตะถะดั ะฑะฐััะฐะผะธ

2. **ะัะธััะบะฐ ะฟะฐะผััะธ**
   - ะะฒัะพัะดะฐะปะตะฝะธะต ะฝะตะฐะบัะธะฒะฝัั ัะตััะธะน (2+ ัะฐัะฐ)
   - ะะธะผะธั 5000 ะทะฐะฟะธัะตะน
   - ะะฝัะตัะฒะฐะป ะพัะธััะบะธ: 30 ะผะธะฝัั

3. **ะะฟัะธะผะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ**
   - Promise.all ะดะปั ะฟะฐัะฐะปะปะตะปัะฝัั ะทะฐะฟัะพัะพะฒ
   - .lean() ะดะปั read-only ะพะฟะตัะฐัะธะน
   - Compound ะธะฝะดะตะบัั

4. **ะัะตัะตะดั ะฐะบัะธะฒะฐัะธะน**
   - ะะพัะปะตะดะพะฒะฐัะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
   - 2 ัะตะบ ะผะตะถะดั ะฐะบัะธะฒะฐัะธัะผะธ
   - ะัะตะดะพัะฒัะฐัะตะฝะธะต ะบะพะฝัะปะธะบัะพะฒ nonce

### ะัะดััะธะต ัะปัััะตะฝะธั (ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ)

- Redis ะดะปั ะบััะธัะพะฒะฐะฝะธั TronGrid ะพัะฒะตัะพะฒ
- Bull queue ะดะปั ัะพะฝะพะฒัั ะทะฐะดะฐั
- ะะปะฐััะตัะฝัะน ัะตะถะธะผ Node.js
- ะะพัะฐัะธั ะฝะตัะบะพะปัะบะธั TronGrid API ะบะปััะตะน

---

## ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ะะพะณะธ

```bash
# ะะตะฟะพะทะธั-ะผะพะฝะธัะพั
๐ Checking deposits for 15 deal(s) in batches of 8...
๐ฆ Processing batch 1/2 (8 deals)...
๐ฐ Deposit detected for deal DEAL_ABC123
โ Deal DEAL_ABC123 marked as locked

# ะะบัะธะฒะฐัะธั
๐ [Queue] Activating multisig TXxx... with 15 TRX
โ [Queue] Activation successful: txhash...

# ะัะธััะบะฐ ะฟะฐะผััะธ
๐งน MessageManager cleanup: removed 45 inactive users, 120 active sessions
```

### ะัะดะธั-ะปะพะณ

ะัะต ะฒะฐะถะฝัะต ะดะตะนััะฒะธั ะทะฐะฟะธััะฒะฐัััั ะฒ `auditlogs`:

- ะกะพะทะดะฐะฝะธะต ัะดะตะปะบะธ
- ะะฑะฝะฐััะถะตะฝะธะต ะดะตะฟะพะทะธัะฐ
- ะะพะดัะฒะตัะถะดะตะฝะธะต ัะฐะฑะพัั
- ะัะฟะปะฐัะฐ
- ะัะบัััะธะต/ะทะฐะบัััะธะต ัะฟะพัะฐ
- ะะตัะตะฝะธะต ะฐัะฑะธััะฐ
- ะะฐะฝ ะฟะพะปัะทะพะฒะฐัะตะปั

### ะะตััะธะบะธ

```javascript
// GET /api/admin/stats
{
  "deals": {
    "total": 1250,
    "active": 45,
    "completed": 1180,
    "disputed": 25
  },
  "volume": {
    "total": 125000,
    "today": 3500,
    "month": 45000
  },
  "users": {
    "total": 850,
    "active": 120,
    "blacklisted": 5
  }
}
```

---

## FAQ

### ะงัะพ ะตัะปะธ ะฟะพะบัะฟะฐัะตะปั ะฝะต ะฟะพะดัะฒะตัะถะดะฐะตั ัะฐะฑะพัั?

ะัะพะดะฐะฒะตั ะพัะบััะฒะฐะตั ัะฟะพั, ะฟัะธะบะปะฐะดัะฒะฐะตั ะดะพะบะฐะทะฐัะตะปัััะฒะฐ. ะัะฑะธัั ะฟัะธะฝะธะผะฐะตั ัะตัะตะฝะธะต ะฒ ัะตัะตะฝะธะต 24-48 ัะฐัะพะฒ.

### ะงัะพ ะตัะปะธ ะฟัะพะดะฐะฒะตั ะฝะต ะฒัะฟะพะปะฝัะตั ัะฐะฑะพัั?

ะะพะบัะฟะฐัะตะปั ะพัะบััะฒะฐะตั ัะฟะพั. ะัะปะธ ัะฐะฑะพัะฐ ะฝะต ัะดะฐะฝะฐ ะดะพ ะดะตะดะปะฐะนะฝะฐ ะธ ะฝะตั ะฐะบัะธะฒะฝะพััะธ โ ะฒะพะทะฒัะฐั ะฟะพะบัะฟะฐัะตะปั.

### ะะธะฝะธะผะฐะปัะฝะฐั ััะผะผะฐ ัะดะตะปะบะธ?

50 USDT (ะฝะฐัััะฐะธะฒะฐะตััั ะฒ .env)

### ะกะบะพะปัะบะพ TRX ะฝัะถะฝะพ ะดะปั ัะฐะฑะพัั?

ะะฐ ะบะพัะตะปัะบะต ะฐัะฑะธััะฐ ัะตะบะพะผะตะฝะดัะตััั ะดะตัะถะฐัั:
- 15 TRX ร ะบะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั ัะดะตะปะพะบ
- + ะทะฐะฟะฐั ะฝะฐ ะฒัะฟะปะฐัั (~ 5 TRX ะฝะฐ ััะฐะฝะทะฐะบัะธั)

### ะะฐะบ ะดะพะฑะฐะฒะธัั ะฝะพะฒะพะณะพ ะฐะดะผะธะฝะฐ?

ะะทะผะตะฝะธัั ADMIN_USERNAME ะธ ADMIN_PASSWORD ะฒ .env, ะฟะตัะตะทะฐะฟัััะธัั ัะตัะฒะธั.

---

## ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:
1. ะัะพะฒะตัััะต ะปะพะณะธ: `pm2 logs keyshield`
2. ะัะพะฒะตัััะต MongoDB: `mongosh keyshield --eval "db.deals.countDocuments()"`
3. ะัะพะฒะตัััะต ะฑะฐะปะฐะฝั ะฐัะฑะธััะฐ: TronScan

---

*ะะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ: 5 ะดะตะบะฐะฑัั 2025*
